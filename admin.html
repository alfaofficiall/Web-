<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Admin Dashboard - ALFA Hosting</title>
    <link rel="icon" type="image/jpeg" href="alfa.jpg" />
    <link rel="stylesheet" href="styles.css" />
    <style>
        body {
            background-color: #f4f7fa;
            color: #34495e;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
        }
        header {
            background-color: #2c3e50;
            color: #ecf0f1;
            padding: 25px 30px;
            font-weight: 700;
            font-size: 1.8rem;
            letter-spacing: 0.12em;
            text-align: center;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
        }
        .container {
            max-width: 1200px;
            margin: 40px auto;
            padding: 0 25px;
        }
        h2 {
            text-align: center;
            margin-bottom: 35px;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 0.12em;
            color: #2c3e50;
            font-size: 1.9rem;
        }
        section {
            background: #ffffff;
            border-radius: 25px;
            padding: 35px 50px;
            margin-bottom: 50px;
            box-shadow: 0 12px 30px rgba(44, 62, 80, 0.12);
            transition: box-shadow 0.3s ease;
        }
        section:hover {
            box-shadow: 0 16px 40px rgba(44, 62, 80, 0.2);
        }
        table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0 12px;
            font-size: 1.05rem;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            border-radius: 15px;
            overflow: hidden;
            display: block;
            overflow-x: auto;
            white-space: nowrap;
        }
        th, td {
            padding: 18px 25px;
            text-align: left;
            color: #34495e;
        }
        th {
            background-color: #2980b9;
            color: white;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            border-bottom: none;
        }
        tbody tr {
            background-color: #f9fbfd;
            border-radius: 15px;
            transition: background-color 0.3s ease;
        }
        tbody tr:hover {
            background-color: #e1e9f7;
        }
        tbody tr td:first-child {
            border-top-left-radius: 15px;
            border-bottom-left-radius: 15px;
        }
        tbody tr td:last-child {
            border-top-right-radius: 15px;
            border-bottom-right-radius: 15px;
        }
        .nav-links {
            text-align: center;
            margin-bottom: 30px;
        }
        .nav-links a {
            color: #2980b9;
            text-decoration: none;
            font-weight: 700;
            margin: 0 20px;
            font-size: 1.2rem;
            transition: color 0.3s ease;
            padding: 8px 15px;
            border-radius: 8px;
            display: inline-block;
        }
        .nav-links a:hover,
        .nav-links a:focus {
            color: #1c5980;
            background-color: #d6e4f7;
            outline: none;
        }
        footer {
            background-color: #2c3e50;
            color: #ecf0f1;
            text-align: center;
            padding: 25px 0;
            font-weight: 700;
            font-size: 1.2rem;
            border-radius: 0 0 25px 25px;
            box-shadow: 0 -6px 16px rgba(44, 62, 80, 0.3);
            user-select: none;
        }
    </style>
</head>
<body>
    <script>
        // Simple password protection for admin page
        const password = 'admin123'; // Set your desired password here
        let attempts = 0;
        function promptPassword() {
            const userInput = prompt('Masukkan password administrator:');
            if (userInput === password) {
                // Password correct, show page content
                document.body.style.display = 'block';
            } else {
                attempts++;
                if (attempts >= 3) {
                    alert('Anda telah memasukkan password salah sebanyak 3 kali. Akses ditolak.');
                    window.location.href = 'index.html';
                } else {
                    alert('Password salah. Silakan coba lagi.');
                    promptPassword();
                }
            }
        }
        // Hide page content initially
        document.body.style.display = 'none';
        window.onload = promptPassword;
    </script>

    <header>
        ALFA Hosting - Admin Dashboard
    </header>
    <div class="container">
        <div class="nav-links">
            <a href="index.html">Kembali ke Beranda</a>
            <a href="admin.html">Dashboard</a>
            <a href="payment.html">Halaman Pembayaran</a>
        </div>

        <section id="orders-section">
            <h2>Pesanan Saat Ini</h2>
            <form id="add-order-form" style="margin-bottom: 20px; display: flex; gap: 10px; flex-wrap: wrap; align-items: center;">
                <input type="text" id="order-service" placeholder="Nama Layanan" required style="flex: 2; padding: 8px; border-radius: 5px; border: 1px solid #ccc;" />
                <input type="number" id="order-quantity" placeholder="Jumlah" min="1" value="1" required style="flex: 1; padding: 8px; border-radius: 5px; border: 1px solid #ccc;" />
                <input type="number" id="order-price" placeholder="Harga (Rp)" min="0" value="0" required style="flex: 1; padding: 8px; border-radius: 5px; border: 1px solid #ccc;" />
                <select id="order-status" required style="flex: 1; padding: 8px; border-radius: 5px; border: 1px solid #ccc;">
                    <option value="Belum Lunas">Belum Lunas</option>
                    <option value="Lunas">Lunas</option>
                </select>
                <button type="submit" style="flex: 1; padding: 8px 12px; background-color: #2980b9; color: white; border: none; border-radius: 5px; cursor: pointer;">Tambah Pesanan</button>
            </form>
            <table id="orders-table" aria-label="Tabel pesanan saat ini">
                <thead>
                    <tr>
                        <th>Layanan</th>
                        <th>Jumlah</th>
                        <th>Harga (Rp)</th>
                        <th>Total Harga (Rp)</th>
                        <th>Status</th>
                        <th>Aksi</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Orders will be dynamically loaded here -->
                </tbody>
            </table>
        </section>

        <section id="testimonials-section">
            <h2>Testimoni Pelanggan</h2>
            <table id="testimonials-table" aria-label="Tabel testimoni pelanggan">
                <thead>
                    <tr>
                        <th>Nama</th>
                        <th>Testimoni</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Testimonials will be dynamically loaded here -->
                </tbody>
            </table>
        </section>

        <section id="site-stats-section">
            <h2>Statistik Situs</h2>
            <p>Total Layanan Terjual: <span id="total-services-sold">0</span></p>
            <p>Total Pendapatan (Rp): <span id="total-revenue">Rp 0</span></p>
            <p>Jumlah Testimoni: <span id="total-testimonials">0</span></p>
        </section>
    </div>

    <footer>
        &copy; 2024 ALFA Hosting. Hak cipta dilindungi.
    </footer>

    <script>
        // Utility function to format number as currency in IDR
        function formatCurrency(num) {
            return num.toLocaleString('id-ID', { style: 'currency', currency: 'IDR', minimumFractionDigits: 0 });
        }

        // Load orders from localStorage cart and paidCart
        function loadOrders() {
            let cart = [];
            let paidCart = [];
            try {
                cart = JSON.parse(localStorage.getItem('cart')) || [];
            } catch (e) {
                console.error('Error parsing cart from localStorage:', e);
                cart = [];
            }
            try {
                paidCart = JSON.parse(localStorage.getItem('paidCart')) || [];
            } catch (e) {
                console.error('Error parsing paidCart from localStorage:', e);
                paidCart = [];
            }
            const ordersTableBody = document.querySelector('#orders-table tbody');
            if (!ordersTableBody) {
                console.error('Orders table body element not found');
                return;
            }
            ordersTableBody.innerHTML = '';

            let totalServices = 0;
            let totalRevenue = 0;

            // Combine paidCart and cart for display, mark status accordingly
            const combinedOrders = [];

            paidCart.forEach(item => {
                combinedOrders.push({ ...item, status: 'Lunas' });
            });

            cart.forEach(item => {
                combinedOrders.push({ ...item, status: 'Belum Lunas' });
            });

            combinedOrders.forEach((item, index) => {
                const row = document.createElement('tr');

                const serviceCell = document.createElement('td');
                serviceCell.textContent = item.service || '';
                row.appendChild(serviceCell);

                const quantityCell = document.createElement('td');
                quantityCell.textContent = item.quantity || 0;
                row.appendChild(quantityCell);

                const priceCell = document.createElement('td');
                priceCell.textContent = formatCurrency(item.price || 0);
                row.appendChild(priceCell);

                const totalPriceCell = document.createElement('td');
                const totalPrice = (item.price || 0) * (item.quantity || 0);
                totalPriceCell.textContent = formatCurrency(totalPrice);
                row.appendChild(totalPriceCell);

                const statusCell = document.createElement('td');
                statusCell.textContent = item.status || '';
                statusCell.style.fontWeight = '700';
                statusCell.style.color = item.status === 'Lunas' ? '#28a745' : '#dc3545';
                row.appendChild(statusCell);

                // Add action buttons cell
                const actionCell = document.createElement('td');

                // Button to toggle payment status
                const toggleStatusBtn = document.createElement('button');
                toggleStatusBtn.textContent = item.status === 'Lunas' ? 'Tandai Belum Lunas' : 'Tandai Lunas';
                toggleStatusBtn.style.marginRight = '10px';
                toggleStatusBtn.addEventListener('click', () => {
                    if (item.status === 'Lunas') {
                        item.status = 'Belum Lunas';
                        // Move item from paidCart to cart
                        const paidIndex = paidCart.findIndex(p => p.service === item.service);
                        if (paidIndex !== -1) {
                            paidCart.splice(paidIndex, 1);
                            cart.push(item);
                        }
                    } else {
                        item.status = 'Lunas';
                        // Move item from cart to paidCart
                        const cartIndex = cart.findIndex(c => c.service === item.service);
                        if (cartIndex !== -1) {
                            cart.splice(cartIndex, 1);
                            paidCart.push(item);
                        }
                    }
                    // Save updated carts
                    localStorage.setItem('cart', JSON.stringify(cart));
                    localStorage.setItem('paidCart', JSON.stringify(paidCart));
                    // Reload orders table
                    loadOrders();
                });
                actionCell.appendChild(toggleStatusBtn);

                // Button to delete order
                const deleteBtn = document.createElement('button');
                deleteBtn.textContent = 'Hapus';
                deleteBtn.style.backgroundColor = '#dc3545';
                deleteBtn.style.color = 'white';
                deleteBtn.addEventListener('click', () => {
                    if (confirm(`Apakah Anda yakin ingin menghapus layanan "${item.service}"?`)) {
                        if (item.status === 'Lunas') {
                            const paidIndex = paidCart.findIndex(p => p.service === item.service);
                            if (paidIndex !== -1) {
                                paidCart.splice(paidIndex, 1);
                            }
                        } else {
                            const cartIndex = cart.findIndex(c => c.service === item.service);
                            if (cartIndex !== -1) {
                                cart.splice(cartIndex, 1);
                            }
                        }
                        localStorage.setItem('cart', JSON.stringify(cart));
                        localStorage.setItem('paidCart', JSON.stringify(paidCart));
                        loadOrders();
                    }
                });
                actionCell.appendChild(deleteBtn);

                row.appendChild(actionCell);

                ordersTableBody.appendChild(row);

                totalServices += item.quantity || 0;
                totalRevenue += totalPrice;
            });

            const totalServicesElem = document.getElementById('total-services-sold');
            if (totalServicesElem) {
                totalServicesElem.textContent = totalServices;
            }
            const totalRevenueElem = document.getElementById('total-revenue');
            if (totalRevenueElem) {
                totalRevenueElem.textContent = formatCurrency(totalRevenue);
            }
        }

        // Load testimonials from localStorage
        function loadTestimonials() {
            const testimonials = JSON.parse(localStorage.getItem('testimonials')) || [];
            const testimonialsTableBody = document.querySelector('#testimonials-table tbody');
            testimonialsTableBody.innerHTML = '';

            testimonials.forEach(testimonial => {
                const row = document.createElement('tr');

                const nameCell = document.createElement('td');
                nameCell.textContent = testimonial.name;
                row.appendChild(nameCell);

                const textCell = document.createElement('td');
                textCell.textContent = testimonial.text;
                row.appendChild(textCell);

                testimonialsTableBody.appendChild(row);
            });

            const totalTestimonialsElem = document.getElementById('total-testimonials');
            if (totalTestimonialsElem) {
                totalTestimonialsElem.textContent = testimonials.length;
            }
        }

        // Initialize dashboard data
        document.addEventListener('DOMContentLoaded', () => {
            loadOrders();
            loadTestimonials();
        });
    </script>
</body>
</html>
